<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utkarsh Exam Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        :root { --primary: #00b0ff; --bg: #f2f4f8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding-bottom: 50px; color: #1e293b; user-select: none; }
        
        /* Header & Grid (Same as before) */
        header { background: white; padding: 15px 20px; display: flex; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 16px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .box img { width: 50px; height: 50px; margin-bottom: 10px; }
        .box-title { font-weight: 700; }

        /* FULL SCREEN PAGE */
        .sheet { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f8f9fa; z-index: 2000; display: flex; flex-direction: column; opacity: 0; visibility: hidden; transform: scale(0.95); transition: 0.2s; }
        .sheet.active { opacity: 1; visibility: visible; transform: scale(1); }
        
        .sheet-header { background: white; padding: 12px 15px; display: flex; align-items: center; gap: 15px; border-bottom: 1px solid #eee; }
        .back-btn { font-size: 1.2rem; cursor: pointer; }
        
        /* LEVEL 1: TOP TABS (Pills) */
        .top-tabs { display: flex; gap: 10px; padding: 15px 20px 5px 20px; background: white; }
        .pill-btn { padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; border: 1px solid #eee; color: #64748b; }
        .pill-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* LEVEL 2: MAIN MENU (Underline Tabs) */
        .tabs-wrapper { background: white; padding-bottom: 0px; box-shadow: 0 4px 5px rgba(0,0,0,0.02); }
        .tabs { display: flex; gap: 20px; overflow-x: auto; padding: 10px 20px 0 20px; scrollbar-width: none; border-bottom: 1px solid #f0f0f0; }
        .tab-link { font-size: 0.9rem; font-weight: 600; color: #64748b; white-space: nowrap; cursor: pointer; padding-bottom: 10px; border-bottom: 3px solid transparent; }
        .tab-link.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        /* LEVEL 3: SUB FILTER (Chips) */
        .sub-filters { display: flex; gap: 8px; overflow-x: auto; padding: 15px 20px 5px 20px; scrollbar-width: none; display: none; } /* Hidden by default */
        .chip { background: white; padding: 5px 12px; border-radius: 6px; font-size: 0.8rem; color: #555; border: 1px solid #ddd; cursor: pointer; white-space: nowrap; }
        .chip.active { background: #333; color: white; border-color: #333; }

        /* Content List */
        .list { overflow-y: auto; flex-grow: 1; padding: 15px 20px 50px 20px; }
        .test-card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }
        .card-title { font-weight: 700; font-size: 0.95rem; }
        .start-btn { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <span style="font-weight:800; color:#4361ee; font-size:1.2rem;">Exam Portal</span>
</header>

<div class="grid" id="examGrid">Loading...</div>

<div class="sheet" id="sheet">
    <div class="sheet-header">
        <i class="fas fa-arrow-left back-btn" onclick="closeSheet()"></i>
        <span style="font-weight:bold; font-size:1.1rem;" id="sheetTitle">Exam Name</span>
    </div>

    <div class="top-tabs" id="topTabsContainer"></div>

    <div class="tabs-wrapper">
        <div class="tabs" id="mainMenuContainer"></div>
    </div>

    <div class="sub-filters" id="subFilterContainer"></div>

    <div class="list" id="listContainer"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDwGzTPmFg-gjoYtNWNJM47p22NfBugYFA",
        authDomain: "mock-test-1eea6.firebaseapp.com",
        databaseURL: "https://mock-test-1eea6-default-rtdb.firebaseio.com",
        projectId: "mock-test-1eea6",
        storageBucket: "mock-test-1eea6.firebaseapp.com",
        messagingSenderId: "111849173136",
        appId: "1:111849173136:web:8b211f58d854119e88a815",
        measurementId: "G-5RLWPTP8YD"
    };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.database();
    let allData = [];

    // --- LOAD DATA ---
    db.ref('exams').on('value', (snapshot) => {
        const data = snapshot.val();
        const grid = document.getElementById('examGrid');
        grid.innerHTML = "";
        if(!data) return;
        
        allData = Object.values(data);
        const uniqueExams = [...new Set(allData.map(item => item.category))];

        uniqueExams.forEach(cat => {
            const item = allData.find(d => d.category === cat);
            let icon = item.icon || "https://cdn-icons-png.flaticon.com/512/2995/2995620.png";
            grid.innerHTML += `
                <div class="box" onclick="openSheet('${cat}')">
                    <img src="${icon}">
                    <div class="box-title">${cat}</div>
                </div>`;
        });
    });

    // --- NAVIGATION LOGIC ---
    let currentExam = "";
    let currentTopTab = "";
    let currentMenu = "";
    let currentSub = "";

    function openSheet(cat) {
        currentExam = cat;
        document.getElementById('sheetTitle').innerText = cat;
        document.getElementById('sheet').classList.add('active');
        
        // 1. Render Top Tabs (Mock Test, PYP)
        const examData = allData.filter(d => d.category === cat);
        const topTabs = [...new Set(examData.map(d => d.topTab || "Mock Tests"))]; // Default if missing
        
        const topCont = document.getElementById('topTabsContainer');
        topCont.innerHTML = "";
        
        topTabs.forEach((tab, idx) => {
            topCont.innerHTML += `<div class="pill-btn ${idx===0?'active':''}" onclick="selectTopTab('${tab}', this)">${tab}</div>`;
        });

        // Select first tab by default
        if(topTabs.length > 0) selectTopTab(topTabs[0], document.querySelector('.pill-btn'));
    }

    function selectTopTab(tab, el) {
        currentTopTab = tab;
        // Visual Update
        document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
        if(el) el.classList.add('active');

        // 2. Render Main Menu (Subject / Category)
        const filtered = allData.filter(d => d.category === currentExam && (d.topTab || "Mock Tests") === tab);
        const menus = [...new Set(filtered.map(d => d.subject))];

        const menuCont = document.getElementById('mainMenuContainer');
        menuCont.innerHTML = "";
        
        menus.forEach((m, idx) => {
            menuCont.innerHTML += `<div class="tab-link ${idx===0?'active':''}" onclick="selectMenu('${m}', this)">${m}</div>`;
        });

        if(menus.length > 0) selectMenu(menus[0], document.querySelector('.tab-link'));
        else document.getElementById('listContainer').innerHTML = "No Content";
    }

    function selectMenu(menu, el) {
        currentMenu = menu;
        document.querySelectorAll('.tab-link').forEach(b => b.classList.remove('active'));
        if(el) el.classList.add('active');

        // 3. Render Sub Filters (Optional Level)
        const filtered = allData.filter(d => d.category === currentExam && (d.topTab || "Mock Tests") === currentTopTab && d.subject === menu);
        
        // Check if any item has a subFilter
        const subFilters = [...new Set(filtered.map(d => d.subFilter).filter(s => s))]; // Filter out empty/undefined
        
        const subCont = document.getElementById('subFilterContainer');
        subCont.innerHTML = "";

        if (subFilters.length > 0) {
            subCont.style.display = 'flex';
            subCont.innerHTML = `<div class="chip active" onclick="selectSub('ALL', this)">All</div>`;
            subFilters.forEach(sub => {
                subCont.innerHTML += `<div class="chip" onclick="selectSub('${sub}', this)">${sub}</div>`;
            });
            selectSub('ALL', document.querySelector('.chip')); // Default to ALL
        } else {
            subCont.style.display = 'none'; // Hide if no subfilters
            renderList(filtered); // Render all directly
        }
    }

    function selectSub(sub, el) {
        currentSub = sub;
        document.querySelectorAll('.chip').forEach(b => b.classList.remove('active'));
        if(el) el.classList.add('active');

        let filtered = allData.filter(d => d.category === currentExam && (d.topTab || "Mock Tests") === currentTopTab && d.subject === currentMenu);
        
        if (sub !== 'ALL') {
            filtered = filtered.filter(d => d.subFilter === sub);
        }
        renderList(filtered);
    }

    function renderList(items) {
        const list = document.getElementById('listContainer');
        list.innerHTML = "";
        items.forEach(item => {
            list.innerHTML += `
                <div class="test-card">
                    <div class="card-info">
                        <div class="card-title">${item.chapter}</div>
                        <div style="font-size:0.8rem; color:#666;">${item.subject} ${item.subFilter ? 'â€¢ '+item.subFilter : ''}</div>
                    </div>
                    <button class="start-btn" onclick="window.location.href='${item.link}'">Start</button>
                </div>
            `;
        });
    }

    function closeSheet() {
        document.getElementById('sheet').classList.remove('active');
    }
</script>

</body>
</html>
